option                  domain-search           "neuronpointer.net";
option                  domain-name             "neuronpointer.net";
# No quotes on the values for domain-name-servers.
option                  domain-name-servers     {% for h in groups['dns-internal'] %}{{ h }}.{{ domain }}{% if not loop.last %}, {% endif %}{% endfor %};
option                  ntp-servers             {% for h in groups['time-server'] %}{{ h }}.{{ domain }}{% if not loop.last %}, {% endif %}{% endfor %};
option                  routers                 {% for h in groups['gateway'] %}{{ h }}.{{ domain }}{% if not loop.last %}, {% endif %}{% endfor %};
option                  broadcast-address       192.168.11.255;
default-lease-time      200;
max-lease-time          200;
authoritative;
log-facility            local7;
ddns-update-style       none;

# http://www.syslinux.org/wiki/index.php?title=PXELINUX#UEFI
option                  architecture-type       code 93 = unsigned integer 16;


# unregistered hosts
subnet 192.168.11.0 netmask 255.255.255.0 {
  range                 192.168.11.10           192.168.11.50;
}


# registered hosts
group {

{% for h in groups['dhcp-clients'] %}
{% if hostvars[h].mac_address is defined and hostvars[h].ip_address %}
  host {{ h }} {
    hardware ethernet   {{ hostvars[h].mac_address }};
    fixed-address       {{ h }}.{{ domain }};
  }

{% else %}
  # {{ h }} is not fully configured.  ip_address and mac_address are required.  See ansible inventory and host_vars.

{% endif %}
{% endfor %}
}


# hosts registered for network booted OS installation
group {
  server-name           {{ groups['debian-netboot'][0] }};
  next-server           {{ hostvars[groups['debian-netboot'][0]].ip_address }};
  filename              "pxelinux/pxelinux.0";

{% for h in groups['netinstall-clients'] %}
{% if hostvars[h].mac_address is defined and hostvars[h].ip_address %}
  host netboot-{{ h }} {
    hardware ethernet   {{ hostvars[h].netboot_mac_address }};
    fixed-address       {{ h }}.{{ domain }};
    if option architecture-type = 00:07 {
      # EFI
      filename          "debian-installer/amd64/bootnetx64.efi";
    } else {
      # BIOS - untested
      filename          "debian-installer/amd64/pxelinux.0";
    }
  }

{% else %}
  # {{ h }} is not fully configured.  ip_address and mac_address are required.  See ansible inventory and host_vars.

{% endif %}
{% endfor %}
{#
  # First instruct PXE firmware to download ipxe, then instruct ipxe to download syslinux.
  #if exists user-class and option user-class = "iPXE" {
    filename            "tftp://{{ inventory_hostname }}/syslinux.efi";
  } else {
    filename            "ipxe.efi";
  }
#}
}
